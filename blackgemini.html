<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entrenador de Estrategia Básica de Blackjack</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Fuente Inter para una mejor legibilidad */
        :root { font-family: 'Inter', sans-serif; }
        /* Estilo general de casino */
        body { background-color: #0A1C16; } 
        .card { 
            display: inline-flex; 
            justify-content: center; 
            align-items: center; 
            width: 5rem; 
            height: 7rem; 
            background-color: white; 
            color: #1a202c; 
            font-size: 2.5rem; 
            font-weight: bold; 
            border: 4px solid #F59E0B; /* Amarillo dorado */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.25);
        }
        .text-neon-green { color: #6EE7B7; } /* Verde neón para el feedback */
        .text-gold { color: #F59E0B; } /* Dorado para títulos */
        .btn-action {
            transition: all 0.15s ease-in-out;
            box-shadow: 0 4px #047857; /* Sombra base para efecto 3D */
            transform: translateY(0);
        }
        .btn-action:hover {
            box-shadow: 0 2px #047857;
            transform: translateY(2px);
        }
        .btn-action:active {
            box-shadow: none;
            transform: translateY(4px);
        }
    </style>
</head>
<body class="min-h-screen p-4 sm:p-8 flex flex-col items-center">

    <script>
        // Configuración y variables globales
        const apiKey = ""; 

        // Constantes de Mazo (simplificado para estrategia: 10, J, Q, K valen 10)
        const CARD_VALUES = [2, 3, 4, 5, 6, 7, 8, 9, 10, 10, 10, 10, 11]; // 11 es el As (A)
        const CARD_LABELS = { 11: 'A', 10: '10', 9: '9', 8: '8', 7: '7', 6: '6', 5: '5', 4: '4', 3: '3', 2: '2' };

        let score = 0;
        let totalHands = 0;

        // Elementos UI
        let elPlayerCards, elDealerCard, elFeedback, elScore, elButtons;

        document.addEventListener('DOMContentLoaded', () => {
            // Asignación de elementos UI
            elPlayerCards = document.getElementById('player-cards');
            elDealerCard = document.getElementById('dealer-card');
            elFeedback = document.getElementById('feedback');
            elScore = document.getElementById('score');
            elButtons = document.getElementById('action-buttons');

            // Iniciar el juego
            newHand();
        });

        // --- Lógica Principal del Juego ---

        /** Genera una carta aleatoria (valor de 2 a 11) */
        function getRandomCardValue() {
            const index = Math.floor(Math.random() * CARD_VALUES.length);
            return CARD_VALUES[index];
        }

        /** Convierte el valor numérico de la carta a su etiqueta (e.g., 11 -> 'A') */
        function getCardLabel(value) {
            if (value === 1) return 'A'; 
            if (value > 10) return CARD_LABELS[10]; 
            return CARD_LABELS[value] || String(value);
        }

        /** Renderiza una mano de cartas */
        function renderCards(container, cards) {
            container.innerHTML = '';
            cards.forEach(cardValue => {
                const label = getCardLabel(cardValue);
                const cardEl = document.createElement('div');
                cardEl.className = 'card m-2 rounded-lg';
                cardEl.textContent = label;
                container.appendChild(cardEl);
            });
        }
        
        /** Normaliza la mano para obtener el total, y si es Soft (tiene As como 11) o Par */
        function normalizeHand(cards) {
            let total = cards.reduce((sum, val) => sum + val, 0);
            let hasAce = cards.includes(11);
            let isPair = cards.length === 2 && cards[0] === cards[1];
            
            // Si el total es > 21 y hay As, convertir As de 11 a 1
            while (total > 21 && hasAce) {
                total -= 10;
                hasAce = false; 
                
                // Buscar el índice del 11 para "convertirlo" a 1
                const aceIndex = cards.findIndex(c => c === 11);
                if (aceIndex !== -1) {
                    cards[aceIndex] = 1; 
                    hasAce = cards.includes(11); 
                }
            }
            
            // Re-calcular si es Soft (si el total se calcula con un As como 11)
            let isSoft = cards.includes(11);

            return { 
                cards, 
                total, 
                isSoft, 
                isPair, 
                // Para simplificar la visualización de Soft A+X:
                softCard: isSoft ? total - 11 : null 
            };
        }

        /** Genera una nueva mano aleatoria para practicar */
        function newHand() {
            // 1. Generar mano del jugador (siempre dos cartas iniciales)
            let playerCards = [getRandomCardValue(), getRandomCardValue()];
            let playerHand = normalizeHand(playerCards);
            
            // 2. Generar carta del crupier
            let dealerCard = getRandomCardValue();

            // Asegurar que la mano no sea Blackjack (21), ya que no requiere acción
            while (playerHand.total === 21 || playerHand.total < 4 || playerHand.total > 21) {
                 playerCards = [getRandomCardValue(), getRandomCardValue()];
                 playerHand = normalizeHand(playerCards);
            }
            
            // Almacenar la mano actual para la verificación
            elPlayerCards.dataset.hand = JSON.stringify(playerHand);
            elDealerCard.dataset.card = dealerCard;
            
            // 3. Renderizar
            renderCards(elPlayerCards, playerCards);
            renderCards(elDealerCard, [dealerCard]);
            
            // 4. Resetear UI
            elFeedback.innerHTML = '<span class="text-xl">Selecciona la acción óptima:</span>';
            elButtons.classList.remove('hidden');
            elButtons.querySelectorAll('button').forEach(btn => {
                btn.classList.remove('bg-gray-700', 'hover:bg-gray-600');
                btn.classList.add('bg-green-700', 'hover:bg-green-600');
                btn.disabled = false;
            });
            updateScoreDisplay();
        }

        /** Muestra la puntuación actual */
        function updateScoreDisplay() {
            elScore.textContent = `Puntuación: ${score} / ${totalHands} (${totalHands > 0 ? (score / totalHands * 100).toFixed(1) : 0}%)`;
        }
        
        /** Compara la acción del usuario con la acción óptima */
        function checkAnswer(userAction) {
            const playerHand = JSON.parse(elPlayerCards.dataset.hand);
            const dealerCard = parseInt(elDealerCard.dataset.card);
            
            const optimalAction = getOptimalAction(playerHand, dealerCard);
            
            totalHands++;
            
            // Resaltar el botón presionado y deshabilitar todos los botones de acción
            elButtons.querySelectorAll('button').forEach(btn => {
                btn.disabled = true;
                if (btn.dataset.action === userAction) {
                    btn.classList.remove('bg-green-700', 'hover:bg-green-600');
                    btn.classList.add('bg-gray-700', 'hover:bg-gray-600');
                }
            });

            let feedbackText = '';
            
            if (userAction === optimalAction) {
                score++;
                feedbackText = `<span class="text-neon-green font-bold text-2xl">¡CORRECTO!</span> La acción óptima es <span class="text-white bg-green-800 px-2 py-1 rounded-md">${translateAction(optimalAction)}</span>.`;
                
                // Si es correcto, avanza automáticamente después de 2 segundos.
                setTimeout(newHand, 2000);

            } else {
                feedbackText = `<span class="text-red-500 font-bold text-2xl">INCORRECTO.</span> La acción óptima es <span class="text-white bg-red-800 px-2 py-1 rounded-md">${translateAction(optimalAction)}</span>. Tu acción fue <span class="text-white bg-gray-800 px-2 py-1 rounded-md">${translateAction(userAction)}</span>.`;
                
                // AÑADIR EXPLICACIÓN DETALLADA
                feedbackText += `<div class="mt-3 text-lg text-gray-200 p-2 border-t border-gray-600">${getStrategyExplanation(playerHand, dealerCard, optimalAction)}</div>`;
                
                // AÑADIR BOTÓN DE CONTINUAR
                feedbackText += `<div class="mt-4"><button onclick="newHand()" class="btn-action bg-yellow-600 hover:bg-yellow-500 text-gray-900 font-bold py-2 px-6 rounded-xl shadow-md">Continuar</button></div>`;
            }
            
            elFeedback.innerHTML = feedbackText;
            updateScoreDisplay();
        }

        /** Traduce la acción (para la visualización) */
        function translateAction(action) {
            switch(action) {
                case 'Hit': return 'Pedir (Hit)';
                case 'Stand': return 'Plantarse (Stand)';
                case 'Double': return 'Doblar (Double)';
                case 'Split': return 'Dividir (Split)';
                default: return action;
            }
        }

        // --- La Estrategia Básica (El Cerebro del Experto) ---

        /** * Devuelve la acción óptima basada en la Estrategia Básica.
         * Reglas asumidas: Doblar en cualquier mano inicial, Crupier se planta en Soft 17.
         * NOTA: Rendición (Surrender) ha sido ELIMINADA, estas manos se juegan como Hit.
         */
        function getOptimalAction(playerHand, dealerCard) {
            const { total, isSoft, isPair, cards } = playerHand;

            // 1. Pares (Pairs) - La carta del crupier es su valor real (2-11)
            if (isPair) {
                const pairValue = cards[0];
                switch (pairValue) {
                    case 11: // Ases (A, A)
                        return 'Split'; 
                    case 10: // Dieces (10, 10)
                        return 'Stand';
                    case 9: // Nueves (9, 9)
                        return (dealerCard === 7 || dealerCard >= 10) ? 'Stand' : 'Split';
                    case 8: // Ochos (8, 8)
                        return 'Split';
                    case 7: // Sietes (7, 7)
                        return dealerCard <= 7 ? 'Split' : 'Hit';
                    case 6: // Seises (6, 6)
                        return dealerCard <= 6 ? 'Split' : 'Hit';
                    case 5: // Cincos (5, 5) -> Se juega como mano dura de 10
                        return dealerCard <= 9 ? 'Double' : 'Hit';
                    case 4: // Cuatros (4, 4)
                        return (dealerCard === 5 || dealerCard === 6) ? 'Split' : 'Hit';
                    case 3: // Treses (3, 3)
                    case 2: // Doses (2, 2)
                        return dealerCard <= 7 ? 'Split' : 'Hit';
                }
            }

            // 2. Manos Blandas (Soft Hands: con un As contado como 11)
            if (isSoft) {
                const softCard = total - 11; // La otra carta (A + X)

                if (total >= 20) return 'Stand'; // A, 9
                if (total === 19) { // A, 8
                    return 'Stand';
                }
                if (total === 18) { // A, 7
                    // Doblar contra 2-6 (se juega Stand contra 7, 8)
                    if (dealerCard >= 2 && dealerCard <= 6) return 'Double'; 
                    // Stand contra 7, 8
                    if (dealerCard === 7 || dealerCard === 8) return 'Stand';
                    // Hit contra 9, 10, A
                    if (dealerCard === 9 || dealerCard === 10 || dealerCard === 11) return 'Hit';
                }
                if (total === 17) { // A, 6
                    return dealerCard >= 3 && dealerCard <= 6 ? 'Double' : 'Hit';
                }
                if (total === 15 || total === 16) { // A, 4 o A, 5
                    return dealerCard >= 4 && dealerCard <= 6 ? 'Double' : 'Hit';
                }
                if (total === 13 || total === 14) { // A, 2 o A, 3
                    return dealerCard >= 5 && dealerCard <= 6 ? 'Double' : 'Hit';
                }
                // Si ninguna de las reglas de Doblar/Stand aplica, por defecto es Hit.
                return 'Hit';
            }

            // 3. Manos Duras (Hard Hands: sin As o con Ases contados como 1)
            
            if (total >= 17) return 'Stand';
            
            if (total === 16 || total === 15 || total === 14 || total === 13) {
                // Manos duras 13-16: Plantarse contra cartas bajas (2-6), Pedir contra cartas altas (7-A)
                // Esto incluye Hard 16 vs 10, A (que era Surrender, ahora Hit) y 15 vs 10 (ahora Hit).
                return dealerCard >= 2 && dealerCard <= 6 ? 'Stand' : 'Hit';
            }
            
            if (total === 12) {
                // 12 vs 2, 3 es Hit. 12 vs 4, 5, 6 es Stand. 12 vs 7+ es Hit.
                return dealerCard >= 4 && dealerCard <= 6 ? 'Stand' : 'Hit';
            }

            // Doblar o Pedir (Hard 9, 10, 11)
            if (total === 11) {
                return 'Double'; // Siempre Doblar en 11
            }
            if (total === 10) {
                // Doblar contra 2-9. Pedir contra 10 o A
                return dealerCard >= 2 && dealerCard <= 9 ? 'Double' : 'Hit';
            }
            if (total === 9) {
                // Doblar contra 3-6. Pedir en otros casos
                return dealerCard >= 3 && dealerCard <= 6 ? 'Double' : 'Hit';
            }
            
            // Manos duras 8 o menos: Siempre Pedir
            return 'Hit';
        }

        /** Genera una explicación detallada de por qué la acción es óptima. */
        function getStrategyExplanation(playerHand, dealerCard, optimalAction) {
            const { total, isSoft, isPair, cards } = playerHand;

            let explanation = '';
            let handType;

            // 1. Identificar el tipo de mano y sus etiquetas
            if (isPair) {
                handType = `Par de ${getCardLabel(cards[0])}'s (${total})`;
            } else if (isSoft) {
                handType = `Mano Blanda (A, ${total - 11} - Total ${total})`;
            } else {
                handType = `Mano Dura (Hard Hand) de ${total}`;
            }

            // 2. Generar explicación basada en la acción óptima
            const dealerLabel = getCardLabel(dealerCard);

            switch (optimalAction) {
                case 'Stand':
                    if (total >= 17) {
                        explanation = `Con ${total} o más, **siempre te plantas** para evitar el riesgo de pasarte (Bust). El crupier debe vencer tu 17.`;
                    } else if (isPair && cards[0] === 10) {
                        explanation = `Un par de 10's es un 20. Nunca se dividen los 10's ni se pide; **Plantarse** es la jugada óptima.`;
                    } else if (!isSoft && total >= 13 && total <= 16 && dealerCard <= 6) {
                        explanation = `Tienes una mano dura vulnerable. El crupier muestra una carta de Bust (${dealerLabel}). **Plantarse** es la jugada óptima para esperar que él se pase.`;
                    } else if (!isSoft && total === 12 && dealerCard >= 4 && dealerCard <= 6) {
                        explanation = `Con un 12, **Plantarse** contra 4, 5 o 6 del crupier minimiza tus pérdidas. Es la excepción a la regla del 12.`;
                    } else if (isSoft && total >= 18) {
                        explanation = `Con un Soft 18 (A, 7) o mejor, **Plantarse** es la jugada estándar contra cartas medias (7, 8).`;
                    }
                    break;
                
                case 'Hit':
                    if (total <= 8) {
                        explanation = `Con ${total} o menos, es **imposible pasarte**. **Siempre** debes pedir para mejorar tu mano.`;
                    } else if (!isSoft && total >= 13 && total <= 16 && dealerCard >= 7) {
                        explanation = `Tienes una mano dura débil (${total}). El crupier muestra una carta fuerte (${dealerLabel}), por lo que debes **Pedir** para intentar alcanzar 17 o más, a pesar del riesgo de Bust.`;
                    } else if (isPair && cards[0] <= 7 && dealerCard > 7) {
                        explanation = `Los pares débiles/medianos, como ${cards[0]}'s, se juegan como mano dura si el crupier tiene una carta alta (${dealerLabel}). **Pedir** es mejor que dividir.`;
                    } else if (isSoft && total <= 17 && optimalAction === 'Hit') {
                        explanation = `Tu mano blanda A+${total - 11} (${total}) no es lo suficientemente fuerte para doblar contra la carta del crupier (${dealerLabel}), pero es segura para **Pedir**.`;
                    }
                    break;

                case 'Double':
                    if (total === 11) {
                        explanation = `**Siempre doblas** con 11, ya que tienes las mejores probabilidades de obtener 20 o 21 en la siguiente carta.`;
                    } else if (total === 10 && dealerCard <= 9) {
                        explanation = `Con 10, **doblas** contra crupieres con cartas bajas (2-9) para aprovechar su debilidad.`;
                    } else if (isSoft && optimalAction === 'Double') {
                        explanation = `Con una mano blanda A+X, **doblas** solo contra las cartas más débiles del crupier (2-6) para maximizar tu ganancia cuando el crupier tiene un alto riesgo de Bust.`;
                    }
                    break;

                case 'Split':
                    if (cards[0] === 11) {
                        explanation = `**Siempre divides los Ases (A, A)**. Esta es la jugada más rentable en Blackjack.`;
                    } else if (cards[0] === 8) {
                        explanation = `**Siempre divides los 8's**. Un 16 duro es la peor mano, al dividirlos, conviertes una mano perdedora en dos manos con potencial para 18.`;
                    } else if (cards[0] === 10) {
                        explanation = `Tienes 20, **nunca divides los 10's**. Plantarse (Stand) es la única jugada.`;
                    } else if (optimalAction === 'Split') {
                        explanation = `Tu par se divide porque la carta del crupier (${dealerLabel}) es débil, lo que te da la oportunidad de ganar en dos manos separadas.`;
                    }
                    break;
            }

            return `**Regla Clave (Mano ${handType} vs ${dealerLabel}):** ${explanation}`;
        }

    </script>

    <div class="w-full max-w-4xl p-6 bg-gray-800 rounded-2xl shadow-2xl">
        
        <h1 class="text-3xl sm:text-4xl font-extrabold text-center mb-6 text-gold">
            🎓 Entrenador de Estrategia Básica de Blackjack 
        </h1>

        <div id="score" class="text-center text-neon-green text-lg font-semibold mb-6">
            Puntuación: 0 / 0 (0%)
        </div>

        <div class="flex flex-col items-center space-y-8 mb-8">
            
            <div class="text-center">
                <p class="text-white text-xl font-bold mb-2">Carta del Crupier</p>
                <div id="dealer-card" class="flex justify-center h-28">
                    </div>
            </div>

            <div class="text-center">
                <p class="text-white text-xl font-bold mb-2">Tu Mano (Jugador)</p>
                <div id="player-cards" class="flex justify-center h-28">
                    </div>
            </div>
            
            <div id="feedback" class="text-center text-xl p-4 bg-gray-700 rounded-lg w-full">
                Selecciona la acción óptima:
            </div>
        </div>

        <div id="action-buttons" class="grid grid-cols-2 sm:grid-cols-4 gap-4">
            <button onclick="checkAnswer('Hit')" data-action="Hit" class="btn-action bg-green-700 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-xl">
                Pedir (Hit)
            </button>
            <button onclick="checkAnswer('Stand')" data-action="Stand" class="btn-action bg-green-700 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-xl">
                Plantarse (Stand)
            </button>
            <button onclick="checkAnswer('Double')" data-action="Double" class="btn-action bg-green-700 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-xl">
                Doblar (Double)
            </button>
            <button onclick="checkAnswer('Split')" data-action="Split" class="btn-action bg-green-700 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-xl">
                Dividir (Split)
            </button>
        </div>

        <p class="text-xs text-gray-400 mt-6 text-center">
            *Estrategia basada en reglas estándar: Crupier se planta en Soft 17 (S17), Permite Doblar en cualquier mano inicial, **Rendición No Permitida**.
        </p>
    </div>

</body>
</html>